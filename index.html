<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LaTeX Equation Studio</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
window.MathJax = {
  tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] },
  svg: { fontCache: 'none' }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --primary: #002b5c;
  --bg: #f6f8fb;
  --panel: #ffffff;
  --border: #d4d9e2;
  --text: #111;
}

body {
  margin: 0;
  font-family: "Georgia", "Times New Roman", serif;
  background: var(--bg);
  color: var(--text);
}

/* HEADER */
.header {
  background: var(--primary);
  color: white;
  text-align: center;
  padding: 14px;
  font-size: 20px;
  letter-spacing: 0.5px;
}

/* MAIN LAYOUT */
.container {
  display: grid;
  grid-template-columns: 0px 5px 40% 5px 1fr;
  height: calc(100vh - 58px);
}

/* HISTORY SIDEBAR */
.history {
  background: var(--panel);
  border-right: 1px solid var(--border);
  padding: 15px;
  overflow-y: auto;
}

.history h3 {
  margin-top: 0;
  font-weight: normal;
  font-size: 16px;
}

.history-item {
  font-size: 14px;
  padding: 6px 4px;
  border-bottom: 1px solid var(--border);
  cursor: pointer;
}

/* EDITOR */
.editor {
  background: var(--panel);
  padding: 20px;
  display: flex;
}

textarea {
  flex: 1;
  resize: none;
  border: 1px solid var(--border);
  padding: 15px;
  font-family: monospace;
  font-size: 16px;
  border-radius: 4px;
}

/* VIEWER */
.viewer {
  display: flex;
  flex-direction: column;
}

.toolbar {
  background: var(--panel);
  padding: 10px 15px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.toolbar-left {
  display: flex;
  gap: 10px;
  align-items: center;
}

button {
  background: var(--primary);
  color: white;
  border: none;
  padding: 6px 12px;
  cursor: pointer;
  border-radius: 4px;
  font-family: inherit;
}

input {
  width: 70px;
  padding: 4px;
}

/* PREVIEW */
.preview-area {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 40px;
}

.preview {
  background: white;
  padding: 60px;
  border: 1px solid var(--border);
  min-width: 200px;
}

/* DIVIDERS */
.divider {
  background: var(--border);
  cursor: col-resize;
}
</style>
</head>

<body>

<div class="header">
  LaTeX Equation Studio <br>
  Powered by ChatGPT
</div>

<div class="container" id="container">

<div class="history" id="historyPanel">
<h3>History</h3>
<div id="historyList"></div>
</div>

<div class="divider" id="dividerLeft"></div>

<div class="editor">
<textarea id="latexInput">
\[
E = mc^2
\]
</textarea>
</div>

<div class="divider" id="dividerRight"></div>

<div class="viewer">

<div class="toolbar">
<div class="toolbar-left">
<button onclick="toggleHistory()">Toggle History</button>
Font:
<input type="number" id="fontSize" value="48">
</div>

<div>
<button onclick="saveSVG()">SVG</button>
<button onclick="savePNG()">PNG</button>
<button onclick="savePDF()">PDF</button>
</div>
</div>

<div class="preview-area">
<div id="preview" class="preview"></div>
</div>

</div>

</div>

<script>

/* HISTORY STORAGE */
let historyStore = JSON.parse(localStorage.getItem("latexHistory") || "[]");

function updateHistory() {
  const list = document.getElementById("historyList");
  list.innerHTML = "";
  historyStore.slice(-10).reverse().forEach(eq => {
    const div = document.createElement("div");
    div.className = "history-item";
    div.textContent = eq.substring(0,40);
    div.onclick = () => {
      document.getElementById("latexInput").value = eq;
      render();
    };
    list.appendChild(div);
  });
}

/* RENDER */
async function render() {
  const latex = document.getElementById("latexInput").value;
  const fontSize = document.getElementById("fontSize").value;
  const preview = document.getElementById("preview");

  preview.style.fontSize = fontSize + "px";
  preview.innerHTML = latex;
  await MathJax.typesetPromise();

  if (!historyStore.includes(latex)) {
    historyStore.push(latex);
    localStorage.setItem("latexHistory", JSON.stringify(historyStore));
    updateHistory();
  }
}

/* LIVE RENDER */
let timer;
document.getElementById("latexInput").addEventListener("input", () => {
  clearTimeout(timer);
  timer = setTimeout(render, 400);
});
document.getElementById("fontSize").addEventListener("input", render);

/* RESIZE LEFT (History) */
const container = document.getElementById("container");
const dividerLeft = document.getElementById("dividerLeft");

dividerLeft.addEventListener("mousedown", () => {
  document.onmousemove = function(e) {
    container.style.gridTemplateColumns =
      e.clientX + "px 5px 40% 5px 1fr";
  };
  document.onmouseup = () => document.onmousemove = null;
});

/* RESIZE RIGHT (Editor) */
const dividerRight = document.getElementById("dividerRight");

dividerRight.addEventListener("mousedown", () => {
  document.onmousemove = function(e) {
    const totalWidth = window.innerWidth;
    const historyWidth = container.children[0].offsetWidth;
    const newEditorWidth = e.clientX - historyWidth - 5;
    container.style.gridTemplateColumns =
      historyWidth + "px 5px " +
      newEditorWidth + "px 5px 1fr";
  };
  document.onmouseup = () => document.onmousemove = null;
});

/* TOGGLE HISTORY */
function toggleHistory() {
  const history = document.getElementById("historyPanel");
  if (history.offsetWidth === 0) {
    container.style.gridTemplateColumns = "250px 5px 40% 5px 1fr";
  } else {
    container.style.gridTemplateColumns = "0px 5px 40% 5px 1fr";
  }
}

/* EXPORT */
function getSVG() {
  return document.querySelector("#preview svg");
}

function saveSVG() {
  const svg = getSVG();
  const source = new XMLSerializer().serializeToString(svg);
  const blob = new Blob([source], {type:"image/svg+xml"});
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "equation.svg";
  link.click();
}

function savePNG() {
  const svg = getSVG();
  const source = new XMLSerializer().serializeToString(svg);
  const img = new Image();
  const blob = new Blob([source], {type:"image/svg+xml"});
  const url = URL.createObjectURL(blob);

  img.onload = function() {
    const canvas = document.createElement("canvas");
    canvas.width = img.width * 3;
    canvas.height = img.height * 3;
    const ctx = canvas.getContext("2d");
    ctx.scale(3,3);
    ctx.drawImage(img,0,0);
    const link = document.createElement("a");
    link.href = canvas.toDataURL();
    link.download = "equation.png";
    link.click();
  };
  img.src = url;
}

function savePDF() {
  const { jsPDF } = window.jspdf;
  const svg = getSVG();
  const source = new XMLSerializer().serializeToString(svg);
  const img = new Image();
  const blob = new Blob([source], {type:"image/svg+xml"});
  const url = URL.createObjectURL(blob);

  img.onload = function() {
    const pdf = new jsPDF({
      orientation: "landscape",
      unit: "px",
      format: [img.width, img.height]
    });
    pdf.addImage(img,"PNG",0,0,img.width,img.height);
    pdf.save("equation.pdf");
  };
  img.src = url;
}

updateHistory();
render();
</script>

</body>
</html>
